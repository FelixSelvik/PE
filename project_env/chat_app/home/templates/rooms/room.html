<!-- chat/templates/chat/room.html -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Chat Room</title>
    <link rel="stylesheet" type="text/css" href="../../static/room.css">
    <link rel="icon" type="image/ico" href="../../static/images/favicon.ico">
</head>

<body>
    <div id="background">
        <nav class="navbar">
            <a href="" class="logo">
                <img src="../../static/images/logo.png" alt="logo" class="icon">
            </a>
            <ul class="nav-links">
                {% if request.user.is_authenticated %}
                <div class="dropdown-div">
                    <button class="drop-button">Rooms</button>
                    <div class="dropdown-items">
                        <a href="#" class="rooms">Room1</a>
                        <a href="#" class="rooms">Room2</a>
                        <a href="#" class="rooms">Room3</a>
                    </div>
                </div>
                <li class="link-style"><a href="https://github.com/FelixSelvik/PE">Github</a></li>
                <li class="username"><a href="">{{ user.username }}</a></li>
                <li class="link-style"><a href="{% url 'logout' %}">Log out</a></li>
                {% else %}


                <li class="link-style"><a href="{% url 'login' %}">Login</a></li>
                <li class="link-style"><a href="{% url 'signup' %}">Sign up</a></li>
                {% endif %}
            </ul>
        </nav>
    </div>
    {% if request.user.is_authenticated %}
    <div class="mainblock">

        <form id="form">
            <input type="text" name="message"/>

        </form>

        <div id="messages"></div>

        <script type="text/javascript">
            let url = `ws://${window.location.host}/ws/socket-server/`

            const chatSocket = new WebSocket(url)

            chatSocket.onmessage = function(e){
                let data = JSON.parse(e.data)
                console.log('Data:', data)

                if(data.type === 'chat'){
                    let messages = document.getElementById('messages')

                    messages.insertAdjacentHTML('beforeend', `<div>
                            <p>${data.message}</p>
                        </div>`)
                }
            } 

            let form = document.getElementById('form')

            form.addEventListener('submit', (e)=> {
                e.preventDefault()
                let message = e.target.message.value
                chatSocket.send(JSON.stringify({
                    'message':message
                }))
                form.reset()
            })

        </script>

    </div>
    {% else %}

    <script>
        window.location.href = "http://127.0.0.1:8000/home";
    </script>

    {% endif %}

    <footer>
        <p>Copyright &copy; Thomas More Mechelen-Antwerp vzw - Campus De Nayer - Professional bachelor
            electronics-ict -
            2023.
        </p>
    </footer>

</body>

</html>